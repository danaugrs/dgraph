<html>
<head>
	<title>UI for Data Visualization</title>

	<style type = "text/css">
	#refresh {
		border: 1px solid black;
    	background: #33cf75;
    	outline:none;
    	width:100px;
    	height:50px;
    	font-family:Helvetica;
	}
	
	.tiles {
		width:200px;
		height:200px;
		float:left;
		text-align:center;
	}
	</style>

	<script type = "text/javascript" src="js/jquery-1.10.2.min.js"></script>

	<script type = "text/javascript">

	function initialize(data) {
		// modify data to point to incoming JSON file
		// console.log('adsf');
		// $.getJSON('data.json', function(data) {
			populateData(JSON.parse(data));
			addButtonFx();
		// });
	}


			// $("#"+data[i].name+"OK").click(function(){
    // alert('clicked!');
// });
	function populateData(data) {
		console.log(data);
		for (var i = 0; i < data.length; i++) {
			console.log(data[i]);
			var main = document.getElementById("nodes");
			var submain = document.createElement("div");
			submain.setAttribute("class","tiles");

			var nameCol = document.createElement("div");
			nameCol.innerHTML += data[i].name + "<br>Status: " + data[i].status + "<br>";

			var buttonCol = document.createElement("div");
			var okButton = document.createElement("input");
			okButton.type = "button";
			okButton.value = "OK";
			okButton.id = data[i].name;
			okButton.name = "OK";
			buttonCol.appendChild(okButton);

			var errorButton = document.createElement("input");
			errorButton.type = "button";
			errorButton.value = "Error";
			errorButton.id = data[i].name;
			errorButton.name = "Error";
			buttonCol.appendChild(errorButton);

			var discButton = document.createElement("input");
			discButton.type = "button";
			discButton.value = "Disconnect";
			discButton.id = data[i].name;
			discButton.name = "Disconnect";
			buttonCol.appendChild(discButton);
			
			main.appendChild(submain);
			submain.appendChild(nameCol);
			submain.appendChild(buttonCol);
		}
	}

	function addButtonFx() {
		var allOK = document.getElementsByName("OK");
		for (var i = 0; i < allOK.length; i++) {
			allOK[i].onclick = function() {
				console.log(this.id + ": " + this.name);
				socket.send(this.id + ": " + this.name);
			}
		}

		var allError = document.getElementsByName("Error");
		for (var i = 0; i < allError.length; i++) {
			allError[i].onclick = function() {
				console.log(this.id + ": " + this.name);
				socket.send(this.id + ": " + this.name);
			}
		}

		var allDisc = document.getElementsByName("Disconnect");
		for (var i = 0; i < allDisc.length; i++) {
			allDisc[i].onclick = function() {
				console.log(this.id + ": " + this.name);
				socket.send(this.id + ": " + this.name);
			}
		}
	}

	function startWebSocket() {
	socket = new WebSocket("ws://localhost:8000", "echo-protocol");

	socket.addEventListener("open", function(event) {
		console.log("WebSocket connected.");
	});

	socket.addEventListener("message", function(event) {
		console.log("WebSocket data incoming:" + event.data);
		initialize(event.data);
	});	

	socket.addEventListener("error", function(event) {
        console.log("Websocket error.");
    });

    socket.addEventListener("close", function(event) {
        console.log("Websocket connection closed.");
    });
}
	</script>
</head>
<body>
<form>
	<input type = "button" onClick = "startWebSocket()" value = "Submit!">
	<br/>
	<div id = "nodes"></div>
</form>
</body>
</html>